# ループの合理性と自由度の両立（まとめ）

「講義 → 演習 → 暗記」のループは、理解・応用・記憶をバランスよく結びつける **最も効率的な学習サイクル** です。講義で学んだ知識を演習で確認し、間違えた部分を暗記カードで定着させることで、脳の仕組みに沿った"自然な成長"が生まれます。

一方で、すべてのユーザーが常に同じペースでループを回すわけではありません。「今日は問題だけやりたい」「時間があるから徹底的に講義を読みたい」など、学習の状況は人によって、そして日によって大きく異なります。

そのため Academy では、最短ルートとしての"ループ"を提示しつつ、同時に"講義だけ""演習だけ""暗記だけ"といった自由な学習行動も尊重する **二層構造の導線** を採用します。

これにより、

- 学習に迷う人には"最適なルート"を
- 自分のペースで進めたい人には"選べる自由"を

どちらも損なうことなく提供でき、幅広い学習者が継続しやすい環境が実現します。

## ① データ収集層（理解度の"材料"になるデータを集める）

まず、ユーザー理解度の分析はデータが揃わないと精度が出ません。よって必要な情報を明確にします。

### 集めるべきデータ（全て DB にすでに構造が存在）

#### 演習データ（`practice_answers`）

- 正答／誤答
- どの Topic に紐づく問題か
- 所要時間
- → **"理解度"の主要データ**

#### 暗記カードデータ（`flashcard_reviews`）

- Again / Normal / Easy
- 次回復習までの間隔
- → **"記憶の定着度"がわかる**

#### 教材閲覧データ（optional）

- どのセクションを読んだか
- 途中離脱か、最後まで読んだか
- → **"理解の準備状況"がわかる**

#### 学習時間（`user_daily_summaries`）

- → **"学習量の実績"**

## ② 分析層（理解度を 1 つのスコアに統合する）

次に、それらのデータを **Topic 単位** で整理します。すでに `user_mastery_scores` が用意されています。

### Mastery スコアの算出ロジック案（シンプルかつ強力）

```
mastery_score =
  (問題正答率 70%)
  + (暗記カード定着度 20%)
  + (最近の学習頻度 10%)
```

### 内訳イメージ

#### ① 問題正答率（過去 30 問など）

- 正答：+1
- 誤答：-1
- 最近の問題ほど重みを強くする

#### ② カード定着度

- Easy：+1
- Normal：±0
- Again：-1
- インターバルが伸びているカードは高評価

#### ③ 最近の学習頻度

- 直近の取り組みが少ない Topic は"忘れ"として軽微に下がる

→ **結果として Topic ごとに 0〜100 の理解度スコアが作れる。**

> ※ すでに DB 設計に `user_mastery_scores` があるので実装上はそこに反映。
> （スコアは毎回クエリ集計でも良いし、バッチ更新でも良い）

## ③ AI アドバイス層（理解度スコアをもとに言語化）

AI の役割は **"言語化"** と **"次の一手の提案"** です。数値そのものではなく、データ → 意味 → 行動に変換する担当。

### AI への入力（プロンプトに渡すデータ構造）

最低限で良いので、以下のような JSON を用意します。

```json
{
  "summary": {
    "studyMinutes": 25,
    "questions": 20,
    "correctRate": 75
  },
  "topics": [
    { "name": "解熱鎮痛薬", "mastery": 80 },
    { "name": "胃腸薬", "mastery": 40 },
    { "name": "かぜの諸症状", "mastery": 55 }
  ],
  "weakness": [
    { "name": "解熱鎮痛薬の副作用", "wrongCount": 3 },
    { "name": "アスピリンの禁忌", "wrongCount": 2 }
  ]
}
```

このように、"要約情報の塊"を AI に渡すことで十分な精度が出ます。

### AI が出すべき 3 点セット

#### ① 今日の総評（褒め＋状況）

**例：**
「今日は 20 問中 15 問正解し、特に『かぜの諸症状』の理解が大きく進んでいます。」

#### ② 具体的な弱点指摘

**例：**
「胃腸薬の副作用に関する問題で誤答が続いているため、明日の演習で重点的に出題します。」

#### ③ 次の一手

**例：**
「明日は『アスピリンの禁忌』カードを先に復習し、その後に第 2 章の軽い講義に進みましょう。」

## 最重要：分析スコア → タスク生成 → AI コメント の連携

実はこの連携がとてもシンプルです。

### Step 1：理解スコアを算出（バックエンド）

- Topic ごとの `user_mastery_scores` を更新
- 弱い Topic を抽出

### Step 2：翌日のタスク生成（バックエンド）

弱い Topic を元に

- 「講義：復習すべき節」
- 「演習：関連問題 3〜5 問」
- 「暗記：関連カード」

などを選出して task を作成

### Step 3：AI に"その日のデータ"を渡す（バックエンド or フロント）

- AI はユーザーに言葉としての意味づけを行う
- 「今日の成長」「明日の重点」を説明

### Step 4：UI 上で表示（フロント）

- 今日のフィードバック
- 明日のタスク
- 弱点の可視化

→ **これでループが成立する**

## 完全にまとめると

### 分析は数値化

（演習と暗記のログ → Topic 別スコア）

### タスク生成はアルゴリズム

（スコアの低い Topic ほど翌日優先）

### AI は"人間の言葉に翻訳"する役

（数値 → 意味 → 行動に変換）

この **三分割モデル** にすると、

- わかりやすく
- 実装しやすく
- 拡張しやすい

仕組みになります。
